<?xml version="1.0"?>
<!DOCTYPE project>
<project name="Protael Build" default="build" basedir=".">

    <property name="base" value="../public_html" />
    <property name="dir.js" value="${base}/js" />
    <property name="dir.css" value="${base}/css" />
    <property name="dir.img" value="${base}/img" />
    <taskdef name="jscomp" classname="com.google.javascript.jscomp.ant.CompileTask"
             classpath="./tools/compiler.jar"/>

<!--    <target name="compile">
        <jscomp compilationLevel="simple" warning="default" 
                debug="false" output="${dir.js}/protael.0.1.0.min.js">
            <sources dir="${dir.js}">
                <file name="Protael.js"/>
            </sources>
        </jscomp>
    
    </target>
    <target name="zip" depends="compile">
        <zip destfile="${base}/Protael.zip" update="true">
            <fileset dir="${base}" includes="protaelSeed.html"/>
            <fileset dir="${base}" includes="js/protael.0.1.0.min.js"/>
            <fileset dir="${base}" includes="css/Protael.css"/>            
        </zip>
    </target>
    -->
    
    <property name="protaelJSpath" value="../../ProtaelJS/public_html/"/>
    
    <target name="buildJS">
        <exec executable="/bin/bash" dir="${protaelJSpath}">
            <arg value="-c"/>
        <arg value="export PATH=/usr/local/bin/:$PATH; /usr/local/bin/grunt"/>
        </exec>
    </target>

    <target name="copyFromProtaelJS" depends="buildJS">
        <!--       
        We need to copy protael files from ProtaelJS project after grunt was run there
        -->
        <copy file="${protaelJSpath}/dist/protael.0.1.0.min.js" todir="${dir.js}"/>
        <copy file="${protaelJSpath}/dist/Protael.zip" todir="${base}"/>
    </target>    
           
    <target name="deploy" depends="copyFromProtaelJS">
        <echo message="Deploying.." />
        <scp keyfile="${user.home}/.ssh/id_rsa" todir="msedova@proteins:apache-tomcat-7.0.42/webapps/Protael/" verbose="true">
            <fileset dir="${base}/">
                <exclude name="**/protaelSeed.html"/>
                <include name="**/*.html"/>
                <include name="**/*.zip"/>
            </fileset>
        </scp>
        <scp keyfile="${user.home}/.ssh/id_rsa" todir="msedova@proteins:apache-tomcat-7.0.42/webapps/Protael/js/" verbose="true">
            <fileset dir="${dir.js}">
                <include name="**/protael.0.1.0.min.js"/>
                <include name="**/main.js"/>
                <include name="**/snap.svg-min.js"/>
            </fileset>
            
        </scp>
        <scp keyfile="${user.home}/.ssh/id_rsa" todir="msedova@proteins:apache-tomcat-7.0.42/webapps/Protael/js/vendor" verbose="true">
            <fileset dir="${dir.js}/vendor">
                <include name="**/*.js"/>
            </fileset>
            
        </scp>
        <scp keyfile="${user.home}/.ssh/id_rsa" todir="msedova@proteins:apache-tomcat-7.0.42/webapps/Protael/css/" verbose="true">
            <fileset dir="${dir.css}">
                <include name="**/*.css"/>
            </fileset>
        </scp>
        <scp keyfile="${user.home}/.ssh/id_rsa" todir="msedova@proteins:apache-tomcat-7.0.42/webapps/Protael/img/" verbose="true">
            <fileset dir="${dir.img}">
                <include name="**/*.*"/>
            </fileset>
        </scp>
    </target>
</project>
Snap.plugin(function(n,u){var t=u.prototype;t.toFront=function(){return this.appendTo(this.paper)};t.toBack=function(){return this.prependTo(this.paper)};t.hide=function(){return this.attr({visibility:"hidden"})};t.show=function(){return this.attr({visibility:"visible"})}});
var Protael=function(){function n(a,b,d,e,c){if(!(this instanceof n))return new n(a,b,d,e,c);var j=navigator.appVersion,h=this;d=$('\x3cdiv class\x3d"ui-widget-content protael_resizable" style\x3d"width:'+d+"; height:"+e+'" \x3e\x3c/div\x3e');e=$('\x3cdiv class\x3d"ui-widget-header ui-corner-all protael_toolbar"\x3e\x3c/div\x3e');var r=$('\x3cdiv width\x3d"100%" height\x3d"100%" class\x3d"protael_svg"\x3e\x3cdiv\x3e\x3cdiv class\x3d"protael_slider"\x3e\x3c/div\x3e\x3c/div\x3e\x3csvg id\x3d"'+b+'_svgcanvas" width\x3d"100%" height\x3d"100%" preserveAspectRatio\x3d"xMinYMin meet"\x3e\x3cdesc\x3eProtael '+
n.version+"\x3c/desc\x3e\x3c/svg\x3e\x3c/div\x3e");$("#"+b).append(d);this.container=b;d.append(e);d.append(r);this.protein=a;t=r.width();(this.controlsEnabled=c)&&$("#"+this.container+" .protael_slider").slider({range:!0,min:1,max:a.sequence.length,values:[1,1],slide:function(a,b){h.setSelection(b.values[0],b.values[1])}});if(c){d.append('\x3cdiv id\x3d"xdialog" title\x3d"Export selection"\x3e\x3ctextarea id\x3d"xarea" cols\x3d"40" rows\x3d"10"\x3e\x3c/textarea\x3e\x3c/div\x3e');var g=this;e.append("Zoom:");
e.append($('\x3cdiv class\x3d"protael_zoomslider"\x3e\x3c/div\x3e').slider({value:g.currentScale(),min:0.5,max:15,step:0.05,slide:function(a,b){g.setZoom(b.value)}}));e.append($("\x3cbutton\x3eZoom to fit\x3c/button\x3e").button({text:!1,icons:{primary:"ui-icon ui-icon-arrow-4-diag"}}).click(function(){g.zoomToFit()}));e.append($("\x3cbutton\x3eZoom to selection\x3c/button\x3e").button({text:!1,icons:{primary:"ui-icon ui-icon-arrowthick-2-e-w"}}).click(function(){g.zoomToSelection()}));e.append('Current selection: \x3cinput type\x3d"text" class\x3d"protael_selection_inp" readonly/\x3e');
e.append($('\x3cbutton id\x3d"export"\x3eExport\x3c/button\x3e').button({text:!1,icons:{primary:"ui-icon-disk"}}).click(function(){$("#xarea").text(g.getConstruct());$("#xdialog").dialog("open")}));$("#xdialog").dialog({modal:!0,autoOpen:!1,buttons:{Ok:function(){$(this).dialog("close")}}});e.append($("\x3cbutton\x3eReset selection\x3c/button\x3e").button({text:!1,icons:{primary:"ui-icon-refresh"}}).click(function(){g.clearSelection()}));e.append("Coloring:");e.append($("\x3cselect\x3e\x3coption\x3eOriginal\x3c/option\x3e\x3coption\x3eClustal\x3c/option\x3e\x3coption\x3eLesk\x3c/option\x3e\x3coption\x3eCinema\x3c/option\x3e\x3coption\x3eMAEditor\x3c/option\x3e\x3coption\x3eALI\x3c/option\x3e\x3coption\x3eNone\x3c/option\x3e\x3c/select\x3e").change(function(){g.setColoringScheme($(this).val())}));
c||e.hide();$(document).tooltip({track:!0,content:function(){var a=$(this);if(a.is("[data-pdb]"))return'\x3cimg src\x3d"http://www.rcsb.org/pdb/images/'+a.data("pdb")+'_bio_r_250.jpg"\x3e';if(a.is("[title]"))return a.attr("title");if(a.is("img"))return a.attr("alt")}});e.append($('\x3cinput type\x3d"checkbox" id\x3d"chkTooltip" checked\x3d"true"\x3e\x3clabel for\x3d"chkTooltip"\x3eCursor tooltips\x3c/label\x3e').change(function(){g.setShowCursorTooltips($("#chkTooltip").is(":checked"))}))}this.selectedx=
[-1,-1];this.svgDiv=$("#"+b+" .protael_svg");this.selectSlider=$("#"+b+" .protael_slider");this.selectInput=$("#"+b+" .protael_selection_inp");this.isChrome=0<=j.indexOf("Chrome")||0<=j.indexOf("Opera");this.currentScaleX=1;this.currentShiftX=0;this.showCursorTooltips=!0;this.paper=new u(b,r.width(),r.height(),this);this.H=w.calcHeight(this.protein);this.W=this.protein.sequence.length;this.paper.setSize(this.W,this.H);this.paper.axis(this.W,10);d.resizable({stop:function(){h.zoomToFit()}})}function u(a,
b,d,e){this.protael=e;this.paper=Snap("#"+a+"_svgcanvas");this.paper.attr({viewBox:"0 0 "+b+" "+d});a=this.paper;this.viewSet=Snap.set();this.textSet=Snap.set();this.overlayFtLabels=Snap.set();this.createDefs();this.gAxes=a.g().attr({id:"axes"});this.gSequences=a.g().attr({Id:"seqs"});this.gFTracks=a.g().attr({id:"ftracks"});this.gQTracks=a.g().attr({Id:"qtracks"});this.seqChars=a.g().attr({id:"seqChars","font-family":"monospace","font-size":"9px","text-anchor":"start","letter-spacing":"0px"});this.seqLines=
a.g().attr({id:"seqLines"});this.seqLineCovers=a.g().attr({id:"seqLineCovers",opacity:0});this.seqBGSet=a.g().attr({id:"seqBGSet",opacity:0.7});this.seqLabelsSet=a.g().attr({"font-size":"9px","text-anchor":"start",id:"seqLabels"})}n.version="0.1.0";var t,x,y={clustal:{G:"orange",P:"orange",S:"orange",T:"orange",H:"red",K:"red",R:"red",F:"blue",W:"blue",Y:"blue",I:"green",L:"green",M:"green",V:"green"},lesk:{G:"orange",A:"orange",S:"orange",T:"orange",C:"green",V:"green",I:"green",L:"green",P:"green",
F:"green",Y:"green",M:"green",W:"green",N:"magenta",Q:"magenta",H:"magenta",D:"red",E:"red",K:"blue",R:"blue"},maeditor:{A:"lightgreen",G:"lightgreen",C:"green",D:"DarkGreen",E:"DarkGreen ",N:"DarkGreen ",Q:"DarkGreen ",I:"blue",L:"blue",M:"blue",V:"blue",F:"#C8A2C8",W:"#C8A2C8",Y:"#C8A2C8",H:"DarkBlue ",K:"orange",R:"orange",P:"pink",S:"red",T:"red"},cinema:{H:"blue",K:"blue",R:"blue",D:"red",E:"red",S:"green",T:"green",N:"green",Q:"green",A:"white",V:"white",L:"white",I:"white",M:"white",F:"magenta",
W:"magenta",Y:"magenta",P:"brown",G:"brown",C:"yellow",B:"grey",Z:"grey",X:"grey"},ali:{A:"grey",R:"grey",N:"grey",D:"grey",C:"grey",E:"grey",Q:"grey",G:"grey",H:"grey",I:"grey",L:"grey",K:"grey",M:"grey",F:"grey",P:"grey",S:"grey",T:"grey",W:"grey",Y:"grey",V:"grey"}};x={getCSchema:function(a){a=a.toLowerCase();return y[a]||y.clustal}};var f=u.prototype;f.setSize=function(a,b){var d=this.paper.attr("viewBox"),e="".concat(b).concat("px");d.height=b;this.paper.attr({height:e,width:a,viewBox:d})};f.getWidth=
function(){return this.paper.attr("width")};f.setZoom=function(a){var b=this.protael,d=a/b.currentScaleX,e=this.getWidth();0<e.indexOf("px")&&(e=e.replace(/[^\d.-]/g,""));e=Math.round(e*d);this.setWidth(Math.round(e));this.viewSet.forEach(function(b){var c=b.attr("x"),e=b.attr("width");if(c)b.attr({x:c*d});else if("line"===b.type){var c=b.attr("x1"),g=b.attr("x2");b.attr({x1:c*d,x2:g*d})}else"path"===b.type&&b.transform("s"+a+" 1 0 0");e&&!isNaN(e)&&b.attr({width:e*d})});this.textSet.forEach(function(a){var b=
a.attr("x");b&&a.attr({x:b*d})});if(this.isChrome){this.strechableSeq.attr({"letter-spacing":"0px"}).hide();var c=this.strechableSeq.getBBox().width,e=e-c,c=this.strechableSeq.attr("numspaces"),e=e/c+"px",c=this.strechableSeq.attr("x");this.strechableSeq.attr({x:c*d,"letter-spacing":e});this.seqChars.attr({"letter-spacing":e})}b.currentScaleX=a;1<b.currentScaleX?this.seqBGSet.show():this.seqBGSet.hide();7<b.currentScaleX?this.seqChars.show():this.seqChars.hide();7<b.currentScaleX?this.overlayFtLabels.forEach(function(a){a.hide()}):
this.overlayFtLabels.forEach(function(a){a.show()})};f.axis=function(a,b){var d,e=a/b+1,c,j,h=this.protael.H,r=this.paper,g=r.g().attr({id:"axLbls","class":"pl-axeslbl"});for(d=0;d<=e;d++)c=r.line(Math.round(d*b),0,Math.round(d*b),h),0===d%5?(c.attr({"class":"major"}),j=r.text(d*b,8,d*b),this.textSet.push(j),g.add(j)):c.attr({"class":"minor"}),this.gAxes.add(c),this.viewSet.push(c);this.gAxes.add(g);return this.gAxes};f.createDefs=function(){var a=this.paper,b=a.g().attr({id:"gap","stroke-width":2});
a.path("m 9.943742,1.54515 0,7.665216 C 9,15 8.977801,15 6,18 5.092011,19.329493 0.900884,20.578894 0,22 -0.903141,20.578894 -4.252632,19.379901 -5.160607,18.050408 -7.745849,14.487355 -9.7582132,11.922758 -9.6863207,9.212778 l 0,-7.667628 -5.7594933,0 0,7.665216 c 0.07412,5.544348 3.171965,8.901205 5.6876008,12.525256 2.6545072,3.598566 6.1354302,5.259308 6.0060532,7.136425 L -3.75216,38 4,38 4,28.866878 c -0.129374,-1.874375 3.351556,-3.535283 6.006045,-7.133892 2.518073,-3.62402 5.613376,-6.978272 5.687696,-12.52262 l 0,-7.665216 z").attr({id:"glycan",
fill:"#000"}).transform("scale(0.3)").toDefs();a.path("m 9.943742,1.54515 0,7.665216 c 0.01858,0.678098 -1.8182777,4.537747 -2.31158,4.024493 L -1.548312,3.388971 -5,6.5 6.022199,18 C 5.11421,19.329493 2.03074,20.719454 1.129856,22.14056 0.226715,20.719454 -4.252632,19.379901 -5.160607,18.050408 -7.745849,14.487355 -9.7582132,11.922758 -9.6863207,9.212778 l 0,-7.667628 -5.7594933,0 0,7.665216 c 0.07412,5.544348 3.171965,8.901205 5.6876008,12.525256 2.6545072,3.598566 6.1354302,5.259308 6.0060532,7.136425 L -3.75216,38 4,38 4,28.866878 c -0.129374,-1.874375 3.351556,-3.535283 6.006045,-7.133892 2.518073,-3.62402 5.613376,-6.978272 5.687696,-12.52262 l 0,-7.665216 z").attr({id:"oliglycan"}).transform("scale(0.3)").toDefs();
a.path("M 9.943742,1.54515 5.757162,5.359859 4,1.625 l -7,0 -2.311321,3.712778 -4.3749997,-3.792628 -5.7594933,0 5.6876008,8.190472 c 2.6545072,3.598566 6.1354302,1.259308 6.0060532,3.136425 L -3.75216,38 4,38 4,12.866878 C 4,11 7.351556,13.331595 10.006045,9.732986 L 15.693741,1.54515 z").attr({id:"unknownglycan"}).transform("scale(0.3) ").toDefs();a.line(0,0,0,12).attr({id:"stick","stroke-width":2}).toDefs();b.add(a.line(0,8,0,30));b.add(a.line(-5,0,0,8));b.add(a.line(5,0,0,8));b.add(a.line(-5,
38,0,30));b.add(a.line(5,38,0,30));b.toDefs()};f.createUse=function(a,b,d,e){a=this.paper.el("use").attr({x:b-0.5,y:d,"xlink:href":"#"+a}).attr(e);this.viewSet.push(a);return a};f.setWidth=function(a){var b=this.paper.attr("viewBox");b.width=a+20;a="".concat(a).concat("px");this.paper.attr({width:a,viewBox:b});this.protael.selectSlider.length&&this.protael.selectSlider.width(a)};f.proteinSeqBG=function(a,b,d,e,c){c=1*c-1||0;var j=this.protael,h=this,r=this.paper;setTimeout(function(){var g=j.currentScale()||
1,k=e?9:3,p,l="white",m=1,q=[],f,n=a.length;for(f=0;f<n;f++)p=b[f]||"white",l!==p&&("white"!==l&&(l=r.rect((m+c)*g,d,(f-m)*g,k).attr({fill:l,stroke:l}),q.push(l),h.viewSet.push(l)),m=f,l=p);"white"!==l&&(l=r.rect((m+c)*g,d,(f-m)*g,k).attr({fill:l,stroke:l}),q.push(l),h.viewSet.push(l));h.seqBGSet.add(q)},10)};f.proteinSequence=function(a,b,d,e){e=e||{};b=b||10;var c=this.paper,j=this,h=e.description,f=c.g().attr({id:"SG_"+h,title:h||""}),g=e.start-1||0,k=this.protael,p=d?15:3,p=c.line(0,b+p/2,this.protael.W,
b+p/2).attr({"class":"pl-seqline"}),h=c.rect(0,b,this.protael.W,10).attr({id:"seq_"+h,title:h||"",opacity:0}),l=a.length;f.add(h,p);e.clazz&&h.attr({"class":e.clazz});e.pdbid&&h.attr({"data-pdb":e.pdbid});this.seqLineCovers.add(h);this.seqLines.add(p);this.viewSet.push(p,h);d&&(this.isChrome?(this.strechableSeq=this.paper.text(g*k.currentScale(),b+8,a.join("")),e=this.strechableSeq.getBBox().width,this.strechableSeq.attr({uwidth:e,numspaces:a.length}),this.textSet.push(this.strechableSeq),this.seqChars.add(this.strechableSeq)):
setTimeout(function(){if(d){var e=[],h,f;for(h=0;h<l;h++)"."!==a[h]&&(f=(g+h)*k.currentScale(),f=c.text(f,b+8,a[h]),e.push(f),j.textSet.push(f));j.seqChars.add(e)}},10))};f.clearColoring=function(){for(var a in this.seqBGSet)this.viewSet.exclude(this.seqBGSet[a]);this.seqBGSet.clear()};f.setColoringScheme=function(a){this.clearColoring();if("none"!==a.toLowerCase()){var b=this.aliTop,d=this.protael.protein,e=d.alidisplay?!0:!1,c=[],j=d.sequence.toUpperCase().split(""),h,f,g,k;if("original"===a.toLowerCase()){if(d.seqcolors){a=
w.splitData(d.seqcolors.data.toUpperCase());for(g=j.length;g--;)c[g]=d.seqcolors.colors[a[g]]}else this.setColoringScheme("none");this.proteinSeqBG(j,c,35,!0);if(d.alignments){h=0;for(f=d.alignments.length;h<f;h++){k=d.alignments[h];c=[];j=k.sequence.split("");if(k.color)for(g=j.length;g--;)c[g]=k.color;else if(k.seqcolors)if(a=w.splitData(k.seqcolors.data.toUpperCase()),k.seqcolors.colors)for(g=j.length;g--;)c[g]=k.seqcolors.colors[a[g]];else{if(d.seqcolors.colors)for(g=j.length;g--;)c[g]=d.seqcolors.colors[a[g]]}else c=
w.getColors(j,x.getCSchema(k.CS||"ALI"));this.proteinSeqBG(j,c,b,e,k.start||0,k.label);b+=10;d.alidisplay&&(b+=5)}}}else if(a=x.getCSchema(a),c=w.getColors(j,a),this.proteinSeqBG(j,c,35,!0),d.alignments)for(h in d.alignments)j=d.alignments[h].sequence.split(""),c=w.getColors(j,a),this.proteinSeqBG(j,c,b,e,d.alignments[h].start||0),b+=10,d.alidisplay&&(b+=5)}};f.featureTrack=function(a,b,d,e,c,j){var h=this.paper,f="pl-ftrack "+(a.clazz||""),f=h.g().attr({id:a.label,"class":f,"font-size":d-8+"px"}),
g=a.display||"block",k=a.color||"",p=[],l=0,m,q,s,n=a.features.length;this.gFTracks.add(f);p.push(0);if(e)for(s=0;s<n;s++){if(m=a.features[s])v=this.feature(m,m.color||k,g,b,d,f,c,e,j),m.click&&v.click(m.click(m.dbxrefs))}else{a.features.sort(function(a,b){return a.start-b.start});c=JSON.parse(JSON.stringify(a.features));for(v=0;0<c.length;)if(m=c.shift())if(q=0,m.draw_level=m.draw_level||0,q=m.draw_level*d,-1===$.inArray(q,p)&&p.push(q),m.draw_level!==l&&(v=0),m.start>=v){var v=this.feature(m,m.color||
k,g,b+q,d,f,!0,e,j);m.click&&v.click(m.click);v=m.end;l=m.draw_level}else m.draw_level++,c.push(m)}if(a.showLine)for(q in b=0+b+d/2-("block"===g?0:-d/2+2),p)d=p[q],d=h.line(0,b+d,this.protael.W,b+d).attr({stroke:"#BBB",fill:"#BBB","stroke-width":"1px",title:a.label||""}).toBack(),f.prepend(d),this.viewSet.push(d);return l};f.feature=function(a,b,d,e,c,j,h,f,g){var k=a.start-1,p=a.end,l,m="pl-feature",q=this.paper;"block"===d?l=q.rect(k,e,p-k,c).attr({}):"line"===d&&(l=q.rect(k,e+c/2+4,p-k,3));b&&
l.attr({fill:b});f&&l.attr({opacity:0.6});a.clazz&&(m+=" "+a.clazz,l.attr({"class":a.clazz}));b=q.g().attr({id:a.label||"",title:a.label,fill:b,"class":m});b.add(l);h&&(a=q.text((k+p)/2,e+c-5,a.label),a.attr({stroke:"none","class":"pl-feature-label"}),b.append(a),this.textSet.push(a),g&&this.overlayFtLabels.push(a));j.add(b);this.viewSet.push(l);return b};f.quantTrack=function(a,b,d,e){var c,j=a.color||"#F00",h=j,f=Math.max.apply(Math,a.values),g=Math.min.apply(Math,a.values),k=100*(-g/(f-g)),p="",
l=e/(f-g),m,q=this.protael.W,n=this.paper;for(c=a.values.length;c<=d;c++)a.values[c]=0;!a.values&&a.data&&(a.values=0<a.data.indexOf(",")?a.data.split(","):a.data.split(""));a.values.splice(0,0,0);for(d=a.values[d]=0;d<q;d++)c=d,m=b+e-(a.values[d]-g)*l,d&&NaN!==d&&(p=p+"L"+c+", "+m),d||(p=p+"M0 "+(b+e+g*l));Array.isArray(j)&&(1==j.length?h=j[0]:2==j.length?h=n.gradient("l(0, 1, 0, 0)"+j[0]+"-"+j[1]):3==j.length&&(h=n.gradient("l(0, 1, 0, 0)"+j[0]+"-"+j[1]+":"+k+"-"+j[2])));j=n.path(p+"L"+q+" "+(b+
e+g*l)+" Z").attr({stroke:j,"stroke-width":0.1,"stroke-linejoin":"round","stroke-linecap":"butt","stroke-dasharray":"",fill:h,opacity:".7"});h=n.text(0.1,b+8,a.label).attr({"font-size":"10px","text-anchor":"start"});g=n.line(0,b,q,b).attr({"class":"pl-chart-top"});f=n.line(0,b+f*l,q,b+f*l).attr({"class":"pl-chart-center"});b=n.line(0,b+e,q,b+e).attr({"class":"pl-chart-bottom"});a=n.g(j,g,b,f,h).attr({id:"qtrack_"+a.label});this.gQTracks.add(a);this.viewSet.push(g);this.viewSet.push(b);this.viewSet.push(f);
this.viewSet.push(j);this.textSet.push(h)};f.proteinMarkers=function(a,b){var d=this.paper.g().attr({id:"gMarkers"}),e,c,f,h,n,g={"font-size":"10px","font-family":"Arial","text-anchor":"middle"};for(e=a.length;e--;)c=a[e],f="bottom"===c.position?26:0,h=c.type?c.type:"glycan",n=c.label?"m_"+c.label:"m_"+e,h=this.createUse(h,c.x,b+f,{id:n,title:c.label?c.label:""}),c.label&&(f="bottom"===c.position?45:0,f=this.paper.text(c.x,b+f,c.label).attr(g),c.color&&f.attr({fill:c.color}),this.textSet.push(f),
d.add(f)),c.color&&h.attr({fill:c.color,stroke:c.color}),d.add(h)};f.proteinBridges=function(a,b){var d=this.paper.g().attr({id:"gBridges","font-size":"10px","font-family":"Arial","text-anchor":"middle","stroke-width":2,"stroke-linejoin":"round","stroke-linecap":"round"}),e=this.paper,c,f,h={},n={fill:"white",stroke:"white"},g,k,p,l,m,q;for(q in a)c=a[q],f=e.g().attr({id:"bridge_"+q}),h={},c.color&&(h={fill:c.color,stroke:c.color}),g=c.start-0.5,k=c.end-0.5,p=(k+g)/2,l=e.line(g,b,g,b+12).attr(h),
this.viewSet.push(l),m=e.line(k,b,k,b+12).attr(h),this.viewSet.push(m),h=e.line(g,b+12,k,b+12).attr(h),this.viewSet.push(h),c.startlabel&&(g=e.text(g,b+21,c.startlabel),c.color&&g.attr({fill:c.color}),this.textSet.push(g),f.add(g)),c.endlabel&&(g=e.text(k,b+21,c.endlabel),c.color&&g.attr({fill:c.color}),this.textSet.push(g),f.add(g)),f.add(l,m,h),c.type&&(g=e.text(p,b+15,c.type),k=c.type.length,p=e.line(p-k/2-1,b+12,p+k/2+1,b+12).attr(n),c.color&&g.attr({fill:c.color}),g.toFront(),this.textSet.push(g),
this.viewSet.push(p),f.add(p,g)),d.add(f)};f.draw=function(a){var b=a.sequence.toUpperCase().split(""),d=35,e=this.paper,c,f,h,n=[],g=[];a.markers&&this.proteinMarkers(a.markers,20);a.bridges&&this.proteinBridges(a.bridges,d+15);a.overlayfeatures&&this.featureTrack(a.overlayfeatures,d-5,20,!0,a.overlayfeatures.showLabels||!1);this.aliTop=d;this.proteinSequence(b,d,!0);this.proteinSeqBG(b,[],d,!0,"main");this.protael.isChrome&&(this.strechableSeq=this.paper.text(0,30,a.sequence).attr({id:"strechableSeq",
"font-family":"monospace","font-size":"9px","text-anchor":"start","letter-spacing":"0px"}).hide(),this.strechableSeq.attr({uwidth:this.strechableSeq.getBBox().width,numspaces:b.length}));d+=30;this.gLabels=this.paper.g().attr({"font-size":"14px","text-anchor":"start",id:"cursor"}).hide();f=a.ftracks?a.ftracks.length:0;for(c=0;c<f;c++)h=a.ftracks[c].allowOverlap||!1,h=this.featureTrack(a.ftracks[c],d,15,h,!0),d+=15*h+20;f=a.qtracks?a.qtracks.length:0;for(c=0;c<f;c++){this.quantTrack(a.qtracks[c],d,
this.protael.W,50);h=e.rect(0,16+d,22,20,4,4).attr({fill:"#000",stroke:"black",color:"white","stroke-width":"2px",opacity:".7"});var k=e.text(0,30+d,"").attr({fill:"white"});this.gLabels.add(h,k);n[c]=k;g[c]=h;a.qtracks[c].topY=d;d+=70}this.aliTop=d;h=a.alidisplay?!0:!1;if(a.alignments){this.protael.setColoringScheme("Original");f=a.alignments.length;for(c=0;c<f;c++){var k=a.alignments[c],p=k.sequence.split("");this.proteinSequence(p,d,h,k);d+=10;a.alidisplay&&(d+=5)}}this.gSequences.add(this.seqLabelsSet,
this.seqBGSet,this.seqChars,this.seqLines);this.labelsWidth=this.seqLabelsSet.getBBox().width;this.seqBGSet.hide();this.seqChars.hide().transform("T1, 0");this.gSequences.toFront();this.seqLines.toBack();this.gAxes.toBack();this.selector=e.rect(-1,0,0,this.protael.H).attr({fill:"#DDD",stroke:"#666","stroke-width":"2px",opacity:0.5,id:"selector"}).hide();this.pointer=e.rect(0,0,2,this.protael.H).attr({fill:"green",stroke:"green",opacity:0.7,id:"pointer"});this.viewSet.push(this.selector);var l=e.rect(0,
46,22,20,4,4).attr({fill:"#000",stroke:"black",color:"white","stroke-width":"2px",opacity:0.7}),m=e.text(0,60,"").attr({fill:"white"});this.seqLineCovers.toFront();var q=this,s=this.protael;h=e.rect(0,0,s.W,s.H).toBack().attr({stroke:"#fff",opacity:0,id:"blanket"});this.gLabels.add(l,m);e.mousemove(function(c){c=c||window.event;var d=c.offsetX,e=this.container+" #blanket";if(void 0===d)var f=$(e),d=c.pageX-f.offset().left;d=Math.round(d+s.currentShiftX);if(!(0>d)&&(q.pointer.attr({x:d+5}).show(),
s.showCursorTooltips))for(f in c=s.toOriginalX(d),m.node.textContent=b[c]+": "+(c+1),q.gLabels.transform("T "+(d+5)+" 0").show(),e=m.getBBox().width,l.attr({width:e}),a.qtracks)e=n[f],d=g[f],e.node.textContent=a.qtracks[f].values[c],e=e.getBBox().width,d.attr({width:e})}).mouseout(function(){q.gLabels.hide();q.pointer.hide()});this.viewSet.push(h)};n.Paper=u;n.prototype.Utils={};n.prototype.Utils.calcHeight=function(a){var b=55,d=0;a.ftracks&&a.ftracks.length&&(b+=15*(a.ftracks.length+2));a.qtracks&&
(b+=70*a.qtracks.length);a.alignments&&(d=a.alidisplay?15:10,b+=d*a.alignments.length);return b+20};n.prototype.Utils.splitData=function(a){return 0<a.indexOf(",")?a.split(","):a.split("")};n.prototype.Utils.getColors=function(a,b){var d=[],e=a.length,c;for(c=0;c<e;c++)d[c]=b[a[c]]||"white";return d};var w=n.prototype.Utils,f=n.prototype;f.draw=function(){this.paper.draw(this.protein);this.CS||this.setColoringScheme("Original");this.setZoom(t/this.W);this.clearSelection();return this};f.setSelection=
function(a,b){this.selectedx[0]=a;this.selectedx[1]=b;var d=this.toScreenX(b)-this.toScreenX(a-1);this.paper.selector.attr({width:d,x:this.toScreenX(a-1)+this.currentShiftX}).show();this.controlsEnabled&&this.selectInput.val(a+":"+b);return this};f.clearSelection=function(){this.selectedx=[-1,-1];this.paper.selector.attr({x:0,width:0}).hide().toBack();this.controlsEnabled&&this.selectInput.val("");var a=this.svgDiv.scrollLeft(),b=$("#"+this.container+" .protael_resizable").width(),a=this.toOriginalX(a+
b/2);this.controlsEnabled&&this.selectSlider.slider("values",[a-1,a+2]);return this};f.translate=function(a){this.svgDiv.scrollLeft(this.svgDiv.scrollLeft()+a);return this};f.zoomIn=function(){this.setZoom(this.currentScaleX+0.1);return this};f.zoomOut=function(){this.setZoom(this.currentScaleX-0.1);return this};f.zoomToFit=function(){var a=this.svgDiv.width();this.setZoom(a/this.W);return this};f.zoomToSelection=function(){if(-1!==this.selectedx[1]){var a=this.selectedx[1]-this.selectedx[0];this.setZoom(this.svgDiv.width()/
a-0.2);a=(this.selectedx[0]+a/2)*this.currentScaleX-this.svgDiv.width()/2;this.svgDiv.scrollLeft(a);return this}};f.setPaperWidth=function(a){this.paper.setWidth(a);return this};f.currentScale=function(){return this.currentScaleX};f.getConstruct=function(){return-1===this.selectedx[0]?"No selection":"\x3e"+(this.protein.label||"construct")+" "+this.selectedx[0]+":"+this.selectedx[1]+"\n"+this.protein.sequence.substring(this.selectedx[0]-1,this.selectedx[1])};f.toOriginalX=function(a){return Math.round((a+
this.currentShiftX)/this.currentScaleX)};f.toScreenX=function(a){return Math.round(a*this.currentScaleX-this.currentShiftX)};f.setShowCursorTooltips=function(a){a||this.paper.gLabels.hide();this.showCursorTooltips=a;return this};f.setZoom=function(a){a=Math.min(a,15);a=Math.max(a,0.5);this.paper.setZoom(a);$("#"+this.container+" .protael_zoomslider").slider("value",this.currentScaleX);return this};f.setColoringScheme=function(a){this.paper.setColoringScheme(a);this.CS=a;return this};f.select=function(a){return Snap.selectAll(a)};
return window.Protael=n}();function ProtaelBrowser(n,u,t,x,y){Protael(n,u,t,x,y).draw()};